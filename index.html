<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>yesyesyes</title>
        <meta name="description" content="">
        <meta name="author" content="">

        <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- Le styles -->
        <link href="static/css/bootstrap.css" rel="stylesheet">
        <style type="text/css">
            .container > footer p {
            text-align: center; /* center align it with the container */
            }

            .topbar .btn {
                border: 0;
            }

            #bannerImage {
                width: 940px;
                height: 100px;
                margin: 0px auto; padding:0;
            }

            .thumbnail {
                width: 90px;
                height: 90px;
            }
        </style>

        <!-- Le fav and touch icons -->
        <link rel="shortcut icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    </head>

    <script src="/_utils/script/json2.js"></script>
    <script src="script/jquery.js"></script>
    <script src="/_utils/script/jquery.couch.js"></script>
    <script src="script/jquery.form.js"></script>
    <script>
        var dbName = 'yesyesyes';

        var articlesDoc = {};
        var authorsDoc = {};
        var bannersDoc = {};

        function loadBanner(image) {
            $('#bannerImage').css('background','url(/'+dbName+'/banners/'+image+')');
        }
        function updateGrid(articlesDoc) {
            for (var i=articlesDoc.data.length-1;i>=0;i--) {
                var logoName = "";
                var docId = "";
                for (var j=0;j<authorsDoc.data.length;j++) {
                    if (articlesDoc.data[i].author === authorsDoc.data[j].name) {
                        logoName = authorsDoc.data[j].logo;
                        break;
                    }
                }
                docId = articlesDoc.data[i].docid;
                $('#article-grid').append('<li><a href="_show/article/'+docId+'"><img class="thumbnail" src="/'+dbName+'/authors/'+logoName+'" alt=""/></a></li>');
            }
        }
        function clearGrid() {
            $('#banners-grid').html('');
        }

        $(function(){
            $('#article-grid').on('mouseover','li',function() {
                if ($('a p',this).length === 0) {
                    $('a',this).prepend('<p>yes</p>');
                }
            });

            $.couch.db(dbName).openDoc('banners', {
                success: function(data) {
                    console.log(data);
                    bannersDoc = data;
                    if (bannersDoc.data.length !== 0) {
                        console.log('load banner');
                        loadBanner(bannersDoc.data[bannersDoc.data.length-1].name);
                    }
                },
                error: function(data) {
                    console.log(data);
                }
            });
            $.couch.db(dbName).openDoc('authors', {
                success: function(data) {
                    console.log(data);
                    authorsDoc = data;
                },
                error: function(data) {
                    console.log(data);
                }
            });
            $.couch.db(dbName).openDoc('articles', {
                success: function(data) {
                    console.log(data);
                    articlesDoc = data;
                    updateGrid(articlesDoc);
                },
                error: function(data) {
                    console.log(data);
                }
            });


        });
    </script>
    <body>
        <div class="container">
            <div class="content">
                <div class="page-header">
                    <ul id="bannerImage">
                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="span12">
                    <ul id="article-grid" class="media-grid">
                    </ul>
                </div>
            </div>

            <footer>
            <p>&copy; YesYesYes 2012</p>
            <p>web stuff by vijay rudraraju</p>
            </footer>

        </div> <!-- /container -->
    </body>
</html>
